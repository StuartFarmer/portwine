============================= test session starts ==============================
platform darwin -- Python 3.10.15, pytest-7.4.4, pluggy-1.5.0 -- /Users/stuart/Library/Caches/pypoetry/virtualenvs/portwine-bKxNQeEh-py3.10/bin/python
cachedir: .pytest_cache
rootdir: /Users/stuart/PycharmProjects/portwine
collecting ... collected 258 items

tests/test_alpaca_broker.py::TestAlpacaBroker::test_get_account_failure PASSED [  0%]
tests/test_alpaca_broker.py::TestAlpacaBroker::test_get_account_success PASSED [  0%]
tests/test_alpaca_broker.py::TestAlpacaBroker::test_get_account_timestamp_type PASSED [  1%]
tests/test_alpaca_broker.py::TestAlpacaBroker::test_get_order_avg_price_none PASSED [  1%]
tests/test_alpaca_broker.py::TestAlpacaBroker::test_get_order_error PASSED [  1%]
tests/test_alpaca_broker.py::TestAlpacaBroker::test_get_order_not_found PASSED [  2%]
tests/test_alpaca_broker.py::TestAlpacaBroker::test_get_order_success PASSED [  2%]
tests/test_alpaca_broker.py::TestAlpacaBroker::test_get_orders_failure PASSED [  3%]
tests/test_alpaca_broker.py::TestAlpacaBroker::test_get_orders_success PASSED [  3%]
tests/test_alpaca_broker.py::TestAlpacaBroker::test_get_position_error PASSED [  3%]
tests/test_alpaca_broker.py::TestAlpacaBroker::test_get_position_exists PASSED [  4%]
tests/test_alpaca_broker.py::TestAlpacaBroker::test_get_position_not_found PASSED [  4%]
tests/test_alpaca_broker.py::TestAlpacaBroker::test_get_positions_failure PASSED [  5%]
tests/test_alpaca_broker.py::TestAlpacaBroker::test_get_positions_success PASSED [  5%]
tests/test_alpaca_broker.py::TestAlpacaBroker::test_get_positions_timestamp_type PASSED [  5%]
tests/test_alpaca_broker.py::TestAlpacaBroker::test_parse_datetime_none PASSED [  6%]
tests/test_alpaca_broker.py::TestAlpacaBroker::test_parse_datetime_with_offset PASSED [  6%]
tests/test_alpaca_broker.py::TestAlpacaBroker::test_submit_order_failure PASSED [  6%]
tests/test_alpaca_broker.py::TestAlpacaBroker::test_submit_order_success PASSED [  7%]
tests/test_alternativeloader.py::TestAlternativeMarketDataLoader::test_fetch_data_mixed_valid_invalid PASSED [  7%]
tests/test_alternativeloader.py::TestAlternativeMarketDataLoader::test_fetch_data_multiple PASSED [  8%]
tests/test_alternativeloader.py::TestAlternativeMarketDataLoader::test_fetch_data_real_file PASSED [  8%]
tests/test_alternativeloader.py::TestAlternativeMarketDataLoader::test_fetch_data_single PASSED [  8%]
tests/test_alternativeloader.py::TestAlternativeMarketDataLoader::test_initialization PASSED [  9%]
tests/test_alternativeloader.py::TestAlternativeMarketDataLoader::test_load_barchart_ticker PASSED [  9%]
tests/test_alternativeloader.py::TestAlternativeMarketDataLoader::test_load_fred_ticker PASSED [ 10%]
tests/test_alternativeloader.py::TestAlternativeMarketDataLoader::test_load_invalid_format PASSED [ 10%]
tests/test_alternativeloader.py::TestAlternativeMarketDataLoader::test_load_invalid_source PASSED [ 10%]
tests/test_alternativeloader.py::TestAlternativeMarketDataLoader::test_load_nonexistent_ticker PASSED [ 11%]
tests/test_alternativeloader.py::TestAlternativeMarketDataLoader::test_loader_without_source_identifier PASSED [ 11%]
tests/test_alternativeloader.py::TestAlternativeMarketDataLoader::test_simple_caching PASSED [ 12%]
tests/test_backtester.py::TestBacktester::test_dynamic_strategy PASSED   [ 12%]
tests/test_backtester.py::TestBacktester::test_empty_strategy PASSED     [ 12%]
tests/test_backtester.py::TestBacktester::test_handling_missing_data PASSED [ 13%]
tests/test_backtester.py::TestBacktester::test_initialization PASSED     [ 13%]
tests/test_backtester.py::TestBacktester::test_invalid_benchmark PASSED  [ 13%]
tests/test_backtester.py::TestBacktester::test_nonexistent_ticker PASSED [ 14%]
tests/test_backtester.py::TestBacktester::test_require_all_history PASSED [ 14%]
tests/test_backtester.py::TestBacktester::test_simple_backtest PASSED    [ 15%]
tests/test_backtester.py::TestBacktester::test_with_date_filtering PASSED [ 15%]
tests/test_backtester.py::TestBacktester::test_with_function_benchmark PASSED [ 15%]
tests/test_backtester.py::TestBacktester::test_with_markowitz_benchmark PASSED [ 16%]
tests/test_backtester.py::TestBacktester::test_with_signal_shifting PASSED [ 16%]
tests/test_backtester.py::TestBacktester::test_with_ticker_benchmark PASSED [ 17%]
tests/test_backtester.py::TestRequireAllHistory::test_require_all_history_false_keeps_full_length PASSED [ 17%]
tests/test_backtester.py::TestRequireAllHistory::test_require_all_history_true_trims_to_common_start PASSED [ 17%]
tests/test_backtester.py::TestBenchmarkDefaultAndInvalid::test_default_benchmark_equal_weight PASSED [ 18%]
tests/test_backtester.py::TestBenchmarkDefaultAndInvalid::test_invalid_benchmark_raises PASSED [ 18%]
tests/test_backtester.py::TestBacktesterWithCalendar::test_benchmark_equal_weight_with_calendar PASSED [ 18%]
tests/test_backtester.py::TestBacktesterWithCalendar::test_calendar_overrides_data_dates PASSED [ 19%]
tests/test_backtester.py::TestBacktesterWithCalendar::test_invalid_benchmark_raises PASSED [ 19%]
tests/test_backtester.py::TestBacktesterWithCalendar::test_invalid_date_range_raises PASSED [ 20%]
tests/test_backtester.py::TestBacktesterWithCalendar::test_non_overlapping_date_range_raises PASSED [ 20%]
tests/test_backtester.py::TestBacktesterWithCalendar::test_require_all_history_cuts_before_benchmark_start PASSED [ 20%]
tests/test_backtester.py::TestBacktesterWithCalendar::test_require_all_history_with_calendar PASSED [ 21%]
tests/test_backtester.py::TestBacktesterWithCalendar::test_start_end_filters_with_calendar PASSED [ 21%]
tests/test_backtester.py::TestBacktesterWithCalendar::test_without_require_all_history_includes_earliest_ticker PASSED [ 22%]
tests/test_backtester_alt.py::TestBacktesterWithAltData::test_alt_data_benchmark_fails PASSED [ 22%]
tests/test_backtester_alt.py::TestBacktesterWithAltData::test_initialization PASSED [ 22%]
tests/test_backtester_alt.py::TestBacktesterWithAltData::test_mixed_data_strategy PASSED [ 23%]
tests/test_backtester_alt.py::TestBacktesterWithAltData::test_ticker_parsing PASSED [ 23%]
tests/test_backtester_alt.py::TestBacktesterWithAltData::test_without_alt_loader PASSED [ 24%]
tests/test_backtester_alt.py::TestAltDataDateFiltering::test_alternative_data_does_not_affect_trading_calendar PASSED [ 24%]
tests/test_backtester_alt.py::TestAltDataDateFiltering::test_dates_from_market_data_only PASSED [ 24%]
tests/test_backtester_alt.py::TestAltDataDateFiltering::test_no_market_data PASSED [ 25%]
tests/test_backtester_alt.py::TestAltDataDateFiltering::test_with_date_filtering PASSED [ 25%]
tests/test_backtester_alt.py::TestOutputsExcludeAltTickers::test_alt_tickers_not_in_outputs PASSED [ 25%]
tests/test_backtester_integration.py::TestBacktesterIntegration::test_alternative_data_influences_regular_signals PASSED [ 26%]
tests/test_backtester_integration.py::TestBacktesterIntegration::test_date_filtering_integration PASSED [ 26%]
tests/test_backtester_integration.py::TestBacktesterIntegration::test_empty_date_range PASSED [ 27%]
tests/test_backtester_integration.py::TestBacktesterIntegration::test_full_backtest_workflow PASSED [ 27%]
tests/test_backtester_intraday.py::TestIntradayBacktester::test_intraday_overnight_signals_raw PASSED [ 27%]
tests/test_backtester_intraday.py::TestIntradayBacktester::test_overnight_intraday_signals_raw PASSED [ 28%]
tests/test_backtester_intraday.py::TestIntradayBacktester::test_signals_shifted PASSED [ 28%]
tests/test_backtester_intraday.py::TestIntradayBacktester::test_start_end_date_filtering PASSED [ 29%]
tests/test_backtester_intraday.py::TestIntradayBacktester::test_union_ts_merges_and_sorts PASSED [ 29%]
tests/test_backtester_intraday.py::TestIntradayReturnCalculations::test_strategy_returns_intraday_overnight PASSED [ 29%]
tests/test_backtester_intraday.py::TestIntradayReturnCalculations::test_strategy_returns_overnight_intraday PASSED [ 30%]
tests/test_backtester_intraday.py::TestIntradayReturnCalculations::test_tickers_returns PASSED [ 30%]
tests/test_broker.py::TestMockBroker::test_get_account PASSED            [ 31%]
tests/test_broker.py::TestMockBroker::test_get_order_by_id PASSED        [ 31%]
tests/test_broker.py::TestMockBroker::test_get_order_not_found_raises PASSED [ 31%]
tests/test_broker.py::TestMockBroker::test_market_is_open_weekday PASSED [ 32%]
tests/test_broker.py::TestMockBroker::test_multiple_orders_and_get_orders PASSED [ 32%]
tests/test_broker.py::TestMockBroker::test_positions_initially_empty PASSED [ 32%]
tests/test_broker.py::TestMockBroker::test_submit_order_and_position_update PASSED [ 33%]
tests/test_broker_data_loader.py::TestBacktesterBrokerLoaderIntegration::test_offline_broker_loader_integration PASSED [ 33%]
tests/test_broker_data_loader.py::TestBrokerDataLoader::test_init_requires_args PASSED [ 34%]
tests/test_broker_data_loader.py::TestBrokerDataLoader::test_live_mode_next_returns_broker_equity PASSED [ 34%]
tests/test_broker_data_loader.py::TestBrokerDataLoader::test_live_update_does_not_affect_broker_equity PASSED [ 34%]
tests/test_broker_data_loader.py::TestBrokerDataLoader::test_offline_mode_next_handles_unknown_ticker PASSED [ 35%]
tests/test_broker_data_loader.py::TestBrokerDataLoader::test_offline_mode_next_returns_initial_equity PASSED [ 35%]
tests/test_broker_data_loader.py::TestBrokerDataLoader::test_offline_multiple_updates PASSED [ 36%]
tests/test_broker_data_loader.py::TestBrokerDataLoader::test_offline_update_changes_equity PASSED [ 36%]
tests/test_broker_data_loader.py::TestExecutionBrokerLoaderIntegration::test_executor_with_broker_loader PASSED [ 36%]
tests/test_execution.py::TestExecutionBaseFetchLatestData::test_loader_exception_raises_data_fetch_error PASSED [ 37%]
tests/test_execution.py::TestExecutionBaseFetchLatestData::test_no_alt_no_timestamp PASSED [ 37%]
tests/test_execution.py::TestExecutionBaseFetchLatestData::test_with_timestamp_float PASSED [ 37%]
tests/test_execution.py::TestExecutionBaseWithRealData::test_fetch_latest_data_real PASSED [ 38%]
tests/test_execution.py::TestExecutionBaseSplitLoaders::test_fetch_latest_data_splits_loaders PASSED [ 38%]
tests/test_execution.py::TestGetCurrentPricesRealData::test_one_ticker PASSED [ 39%]
tests/test_execution.py::TestGetCurrentPricesRealData::test_three_tickers_with_missing_nflx PASSED [ 39%]
tests/test_execution.py::TestGetCurrentPricesRealData::test_two_tickers PASSED [ 39%]
tests/test_execution.py::TestExecutionStepSingle::test_add_on_buy_multiple PASSED [ 40%]
tests/test_execution.py::TestExecutionStepSingle::test_add_on_buy_single PASSED [ 40%]
tests/test_execution.py::TestExecutionStepSingle::test_initial_buy_and_add_on PASSED [ 41%]
tests/test_execution.py::TestExecutionStepSingle::test_initial_buy_and_sell PASSED [ 41%]
tests/test_execution.py::TestExecutionStepSingle::test_initial_buy_multiple PASSED [ 41%]
tests/test_execution.py::TestExecutionStepSingle::test_initial_buy_single PASSED [ 42%]
tests/test_execution.py::TestExecutionStepSingle::test_mixed_add_and_reduce PASSED [ 42%]
tests/test_execution.py::TestExecutionStepSingle::test_reduce_multiple PASSED [ 43%]
tests/test_execution.py::TestExecutionStepSingle::test_reduce_single PASSED [ 43%]
tests/test_execution.py::TestExecutionStepMulti::test_add_on_buy_multiple PASSED [ 43%]
tests/test_execution.py::TestExecutionStepMulti::test_add_on_buy_single PASSED [ 44%]
tests/test_execution.py::TestExecutionStepMulti::test_initial_buy_and_add_on PASSED [ 44%]
tests/test_execution.py::TestExecutionStepMulti::test_initial_buy_and_sell PASSED [ 44%]
tests/test_execution.py::TestExecutionStepMulti::test_initial_buy_multiple PASSED [ 45%]
tests/test_execution.py::TestExecutionStepMulti::test_initial_buy_single PASSED [ 45%]
tests/test_execution.py::TestExecutionStepMulti::test_mixed_add_and_reduce PASSED [ 46%]
tests/test_execution.py::TestExecutionStepMulti::test_reduce_multiple PASSED [ 46%]
tests/test_execution.py::TestExecutionStepMulti::test_reduce_single PASSED [ 46%]
tests/test_execution.py::TestCalculateTargetPositions::test_all_in_one_ticker PASSED [ 47%]
tests/test_execution.py::TestCalculateTargetPositions::test_fractional_keeps_value PASSED [ 47%]
tests/test_execution.py::TestCalculateTargetPositions::test_mixed_tickers PASSED [ 48%]
tests/test_execution.py::TestCalculateTargetPositions::test_no_fractional_rounds_down PASSED [ 48%]
tests/test_execution.py::TestCalculateTargetPositions::test_symbols_not_in_prices_skipped PASSED [ 48%]
tests/test_execution.py::TestCalculateTargetPositionsWithRealData::test_real_all_in_one_ticker PASSED [ 49%]
tests/test_execution.py::TestCalculateTargetPositionsWithRealData::test_real_fractional_keeps PASSED [ 49%]
tests/test_execution.py::TestCalculateTargetPositionsWithRealData::test_real_mixed_tickers PASSED [ 50%]
tests/test_execution.py::TestCalculateTargetPositionsWithRealData::test_real_no_fractional_rounds_down PASSED [ 50%]
tests/test_execution.py::TestCalculateCurrentWeights::test_exceeds_portfolio_raises PASSED [ 50%]
tests/test_execution.py::TestCalculateCurrentWeights::test_exceeds_portfolio_returns_when_not_raising PASSED [ 51%]
tests/test_execution.py::TestCalculateCurrentWeights::test_includes_ticker_with_no_position PASSED [ 51%]
tests/test_execution.py::TestCalculateCurrentWeights::test_multiple_tickers PASSED [ 51%]
tests/test_execution.py::TestCalculateCurrentWeights::test_single_ticker PASSED [ 52%]
tests/test_execution.py::TestTargetPositionsToOrders::test_add_on_buy_multiple PASSED [ 52%]
tests/test_execution.py::TestTargetPositionsToOrders::test_add_on_buy_single PASSED [ 53%]
tests/test_execution.py::TestTargetPositionsToOrders::test_initial_buy_and_add_on PASSED [ 53%]
tests/test_execution.py::TestTargetPositionsToOrders::test_initial_buy_and_sell PASSED [ 53%]
tests/test_execution.py::TestTargetPositionsToOrders::test_initial_buy_multiple PASSED [ 54%]
tests/test_execution.py::TestTargetPositionsToOrders::test_initial_buy_single PASSED [ 54%]
tests/test_execution.py::TestTargetPositionsToOrders::test_mixed_add_and_reduce PASSED [ 55%]
tests/test_execution.py::TestTargetPositionsToOrders::test_reduce_multiple PASSED [ 55%]
tests/test_execution.py::TestTargetPositionsToOrders::test_reduce_single PASSED [ 55%]
tests/test_execution.py::TestExecuteOrders::test_execute_orders_error_propagates PASSED [ 56%]
tests/test_execution.py::TestExecuteOrders::test_execute_orders_success PASSED [ 56%]
tests/test_execution.py::TestExecutionRun::test_run_calls_step_for_each_timestamp PASSED [ 56%]
tests/test_logging.py::TestLogger::test_create_console_only PASSED       [ 57%]
tests/test_logging.py::TestLogger::test_create_file_handler_no_rotate PASSED [ 57%]
tests/test_logging.py::TestLogger::test_create_file_handler_rotating PASSED [ 58%]
tests/test_logging.py::TestLogger::test_logging_levels PASSED            [ 58%]
tests/test_market_data_loader.py::MarketDataLoaderTests::test__get_bar_at_or_before_before_all PASSED [ 58%]
tests/test_market_data_loader.py::MarketDataLoaderTests::test__get_bar_at_or_before_between PASSED [ 59%]
tests/test_market_data_loader.py::MarketDataLoaderTests::test__get_bar_at_or_before_empty_df PASSED [ 59%]
tests/test_market_data_loader.py::MarketDataLoaderTests::test__get_bar_at_or_before_exact PASSED [ 60%]
tests/test_market_data_loader.py::MarketDataLoaderTests::test_fetch_data_caching PASSED [ 60%]
tests/test_market_data_loader.py::MarketDataLoaderTests::test_fetch_data_with_unknown_tickers PASSED [ 60%]
tests/test_market_data_loader.py::MarketDataLoaderTests::test_get_all_dates_empty_list PASSED [ 61%]
tests/test_market_data_loader.py::MarketDataLoaderTests::test_get_all_dates_union_and_sort PASSED [ 61%]
tests/test_market_data_loader.py::MarketDataLoaderTests::test_load_ticker_not_implemented PASSED [ 62%]
tests/test_market_data_loader.py::MarketDataLoaderTests::test_next_before_all PASSED [ 62%]
tests/test_market_data_loader.py::MarketDataLoaderTests::test_next_exact_and_closest PASSED [ 62%]
tests/test_market_data_loader.py::MarketDataLoaderTests::test_next_malformed_dataframe PASSED [ 63%]
tests/test_market_data_loader.py::MarketDataLoaderTests::test_next_unknown_ticker PASSED [ 63%]
tests/test_mock_broker.py::TestMockBroker::test_buy_then_partial_sell PASSED [ 63%]
tests/test_mock_broker.py::TestMockBroker::test_get_order_not_found_raises PASSED [ 64%]
tests/test_mock_broker.py::TestMockBroker::test_get_position_not_held PASSED [ 64%]
tests/test_mock_broker.py::TestMockBroker::test_initial_account_custom_equity PASSED [ 65%]
tests/test_mock_broker.py::TestMockBroker::test_initial_account_default_equity PASSED [ 65%]
tests/test_mock_broker.py::TestMockBroker::test_initial_positions_and_orders_empty PASSED [ 65%]
tests/test_mock_broker.py::TestMockBroker::test_multiple_orders_unique_ids PASSED [ 66%]
tests/test_mock_broker.py::TestMockBroker::test_order_timestamps_are_equal_and_datetime PASSED [ 66%]
tests/test_mock_broker.py::TestMockBroker::test_positions_removal_when_zero PASSED [ 67%]
tests/test_mock_broker.py::TestMockBroker::test_submit_buy_updates_position_and_returns_order PASSED [ 67%]
tests/test_mock_broker.py::TestMockBroker::test_submit_sell_without_prior_position PASSED [ 67%]
tests/test_scheduler.py::TestFiniteDailySchedule::test_open_only_single_day 