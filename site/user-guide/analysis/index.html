<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Portwine Team" /><link rel="canonical" href="https://github.com/StuartFarmer/portwine/user-guide/analysis/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Analysis - Portwine Documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Analysis";
        var mkdocs_page_input_path = "user-guide/analysis.md";
        var mkdocs_page_url = "/StuartFarmer/portwine/user-guide/analysis/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Portwine Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Getting Started</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../getting-started/installation/">Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../getting-started/quick-start/">Quick Start</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">User Guide</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../strategies/">Strategies</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../backtesting/">Backtesting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../data-management/">Data Management</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Analysis</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#built-in-analyzers">Built-in Analyzers</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#equity-drawdown-analyzer">Equity Drawdown Analyzer</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#grid-equity-drawdown-analyzer">Grid Equity Drawdown Analyzer</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#monte-carlo-analyzer">Monte Carlo Analyzer</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#seasonality-analyzer">Seasonality Analyzer</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#correlation-analyzer">Correlation Analyzer</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#strategy-comparison-analyzer">Strategy Comparison Analyzer</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#train-test-equity-drawdown-analyzer">Train Test Equity Drawdown Analyzer</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#students-t-test-analyzer">Student's T-Test Analyzer</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#transaction-cost-analyzer">Transaction Cost Analyzer</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#noise-robustness-analyzer">Noise Robustness Analyzer</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#regime-change-analyzer">Regime Change Analyzer</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#writing-your-own-analyzers">Writing Your Own Analyzers</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#step-1-import-required-libraries">Step 1: Import Required Libraries</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-2-define-your-analyzer-class">Step 2: Define Your Analyzer Class</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-3-initialize-your-analyzer">Step 3: Initialize Your Analyzer</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-4-implement-the-analysis-logic">Step 4: Implement the Analysis Logic</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-5-calculate-performance-metrics">Step 5: Calculate Performance Metrics</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-6-implement-the-required-plot-method">Step 6: Implement the Required Plot Method</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-7-add-helper-methods">Step 7: Add Helper Methods</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#step-8-usage-example">Step 8: Usage Example</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#key-design-principles">Key Design Principles</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#next-steps">Next Steps</a>
    </li>
    </ul>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../contributing/">Contributing</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Portwine Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">User Guide</li>
      <li class="breadcrumb-item active">Analysis</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/StuartFarmer/portwine/edit/main/docs/user-guide/analysis.md">Edit on portwine</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="performance-analysis">Performance Analysis</h1>
<p>Portwine provides comprehensive tools for analyzing strategy performance, from basic metrics to advanced visualizations.</p>
<h2 id="built-in-analyzers">Built-in Analyzers</h2>
<p>Portwine comes with a comprehensive suite of analyzers that make it easy to understand your strategy's performance across different dimensions:</p>
<h3 id="equity-drawdown-analyzer">Equity Drawdown Analyzer</h3>
<p>The foundational analyzer that provides essential performance visualization and metrics. This analyzer creates clear, professional plots showing equity curves and drawdown analysis.</p>
<p><strong>What it generates:</strong>
- Equity curve comparison (strategy vs benchmark) with clear visual distinction
- Drawdown analysis showing peak-to-trough declines
- Performance metrics table with key statistics
- Professional formatting with proper legends and grid lines</p>
<p><strong>Best for:</strong> Initial strategy evaluation, performance overview, and stakeholder presentations.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">portwine.analyzers</span><span class="w"> </span><span class="kn">import</span> <span class="n">EquityDrawdownAnalyzer</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="c1"># Create analyzer</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="n">analyzer</span> <span class="o">=</span> <span class="n">EquityDrawdownAnalyzer</span><span class="p">()</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="c1"># Plot results</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="n">analyzer</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</code></pre></div>
<h3 id="grid-equity-drawdown-analyzer">Grid Equity Drawdown Analyzer</h3>
<p>A powerful multi-strategy comparison tool that displays multiple strategy results in a grid layout. Each grid cell contains both equity curves and drawdown analysis for easy side-by-side comparison.</p>
<p><strong>What it generates:</strong>
- Grid layout with customizable columns (default: 2 columns)
- Each cell shows equity curves and drawdowns for one strategy
- Color-coded fill areas showing outperformance/underperformance
- Compact design perfect for comparing multiple strategies or parameter sets</p>
<p><strong>Best for:</strong> Comparing multiple strategies, parameter optimization results, or basket analysis.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">portwine.analyzers</span><span class="w"> </span><span class="kn">import</span> <span class="n">GridEquityDrawdownAnalyzer</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="c1"># Create analyzer</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="n">analyzer</span> <span class="o">=</span> <span class="n">GridEquityDrawdownAnalyzer</span><span class="p">()</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="c1"># Plot multiple strategies</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="n">analyzer</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results_list</span><span class="p">,</span> <span class="n">titles</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div>
<h3 id="monte-carlo-analyzer">Monte Carlo Analyzer</h3>
<p>Performs Monte Carlo simulations to assess strategy robustness and understand the distribution of possible outcomes. This analyzer helps determine if your strategy's performance is stable or subject to significant randomness.</p>
<p><strong>What it generates:</strong>
- Distribution of possible outcomes through random sampling
- Confidence intervals for key metrics
- Risk assessment through multiple simulation paths
- Statistical validation of strategy performance</p>
<p><strong>Best for:</strong> Risk assessment, strategy validation, and understanding performance uncertainty.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">portwine.analyzers</span><span class="w"> </span><span class="kn">import</span> <span class="n">MonteCarloAnalyzer</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="c1"># Run Monte Carlo analysis</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="n">analyzer</span> <span class="o">=</span> <span class="n">MonteCarloAnalyzer</span><span class="p">()</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="n">analyzer</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">n_simulations</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</code></pre></div>
<h3 id="seasonality-analyzer">Seasonality Analyzer</h3>
<p>Analyzes performance patterns across different time periods to identify seasonal effects, day-of-week patterns, and other temporal dependencies in your strategy.</p>
<p><strong>What it generates:</strong>
- Monthly performance heatmaps and bar charts
- Day-of-week analysis showing intra-week patterns
- Quarterly and annual seasonal trends
- Statistical significance testing for seasonal effects</p>
<p><strong>Best for:</strong> Understanding temporal patterns, optimizing rebalancing schedules, and identifying seasonal opportunities.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">portwine.analyzers</span><span class="w"> </span><span class="kn">import</span> <span class="n">SeasonalityAnalyzer</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="c1"># Analyze seasonal patterns</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="n">analyzer</span> <span class="o">=</span> <span class="n">SeasonalityAnalyzer</span><span class="p">()</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="n">analyzer</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="s2">&quot;monthly&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="correlation-analyzer">Correlation Analyzer</h3>
<p>Computes and visualizes correlation matrices among the assets in your strategy. This analyzer helps understand the relationships between different positions and identify potential diversification benefits or concentration risks.</p>
<p><strong>What it generates:</strong>
- Correlation matrix heatmap with color-coded values
- Statistical correlation analysis using multiple methods (Pearson, Spearman, Kendall)
- Asset relationship visualization
- Diversification assessment</p>
<p><strong>Best for:</strong> Portfolio construction, risk management, and understanding asset relationships.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">portwine.analyzers</span><span class="w"> </span><span class="kn">import</span> <span class="n">CorrelationAnalyzer</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="c1"># Analyze correlations</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="n">analyzer</span> <span class="o">=</span> <span class="n">CorrelationAnalyzer</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">)</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="n">analyzer</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</code></pre></div>
<h3 id="strategy-comparison-analyzer">Strategy Comparison Analyzer</h3>
<p>A comprehensive tool for comparing two strategies side-by-side with statistical rigor. This analyzer provides detailed statistical tests and rolling analysis to understand the differences between strategies.</p>
<p><strong>What it generates:</strong>
- Side-by-side equity curve comparison with fill areas
- Statistical significance tests (t-tests) between strategies
- Rolling correlation, alpha, and beta analysis
- Performance metrics comparison table</p>
<p><strong>Best for:</strong> Strategy selection, A/B testing, and understanding strategy differences.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">portwine.analyzers</span><span class="w"> </span><span class="kn">import</span> <span class="n">StrategyComparisonAnalyzer</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="c1"># Compare strategies</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="n">analyzer</span> <span class="o">=</span> <span class="n">StrategyComparisonAnalyzer</span><span class="p">()</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="n">analyzer</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">comparison_results</span><span class="p">,</span> <span class="n">label_main</span><span class="o">=</span><span class="s2">&quot;Strategy A&quot;</span><span class="p">,</span> <span class="n">label_compare</span><span class="o">=</span><span class="s2">&quot;Strategy B&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="train-test-equity-drawdown-analyzer">Train Test Equity Drawdown Analyzer</h3>
<p>Evaluates strategy robustness by splitting data into training and testing periods. This analyzer helps identify overfitting and ensures your strategy generalizes well to unseen data.</p>
<p><strong>What it generates:</strong>
- Equity curves with clear train/test split visualization
- Drawdown analysis for both periods
- Histogram comparison of train vs test returns
- Comprehensive metrics table with overfitting ratios
- Color-coded performance indicators</p>
<p><strong>Best for:</strong> Model validation, overfitting detection, and ensuring strategy robustness.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">portwine.analyzers</span><span class="w"> </span><span class="kn">import</span> <span class="n">TrainTestEquityDrawdownAnalyzer</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="c1"># Analyze train/test performance</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="n">analyzer</span> <span class="o">=</span> <span class="n">TrainTestEquityDrawdownAnalyzer</span><span class="p">()</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="n">analyzer</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</code></pre></div>
<h3 id="students-t-test-analyzer">Student's T-Test Analyzer</h3>
<p>Provides statistical rigor to your strategy evaluation through formal hypothesis testing. This analyzer determines whether your strategy's performance is statistically significant compared to zero or a benchmark.</p>
<p><strong>What it generates:</strong>
- Statistical significance testing vs zero returns
- Comparison testing vs benchmark returns
- Return distribution histograms
- Color-coded significance indicators
- Plain English interpretation of results</p>
<p><strong>Best for:</strong> Statistical validation, academic research, and formal strategy evaluation.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">portwine.analyzers</span><span class="w"> </span><span class="kn">import</span> <span class="n">StudentsTTestAnalyzer</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="c1"># Perform statistical testing</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="n">analyzer</span> <span class="o">=</span> <span class="n">StudentsTTestAnalyzer</span><span class="p">()</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="n">analyzer</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">with_equity_curve</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<h3 id="transaction-cost-analyzer">Transaction Cost Analyzer</h3>
<p>Models the real-world impact of transaction costs on strategy performance. This analyzer helps understand how different cost levels affect your strategy and identifies the breakeven point for profitability.</p>
<p><strong>What it generates:</strong>
- Performance degradation analysis across cost levels
- Portfolio turnover analysis with rolling metrics
- Breakeven analysis showing cost tolerance
- Equity curves for different cost scenarios
- Comprehensive cost impact report</p>
<p><strong>Best for:</strong> Real-world implementation planning, cost optimization, and profitability analysis.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">portwine.analyzers</span><span class="w"> </span><span class="kn">import</span> <span class="n">TransactionCostAnalyzer</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="c1"># Analyze transaction cost impact</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="n">analyzer</span> <span class="o">=</span> <span class="n">TransactionCostAnalyzer</span><span class="p">(</span><span class="n">cost_levels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.0005</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.002</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">])</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="n">analyzer</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</code></pre></div>
<h3 id="noise-robustness-analyzer">Noise Robustness Analyzer</h3>
<p>Tests strategy stability by injecting controlled levels of noise into market data. This analyzer helps determine if your strategy is robust to market noise or if it's overfitted to specific data patterns.</p>
<p><strong>What it generates:</strong>
- Performance stability across noise levels
- Statistical distribution of outcomes
- Robustness metrics and confidence intervals
- Noise tolerance assessment</p>
<p><strong>Best for:</strong> Strategy validation, robustness testing, and overfitting detection.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">portwine.analyzers</span><span class="w"> </span><span class="kn">import</span> <span class="n">NoiseRobustnessAnalyzer</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="c1"># Test noise robustness</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="n">analyzer</span> <span class="o">=</span> <span class="n">NoiseRobustnessAnalyzer</span><span class="p">(</span><span class="n">base_loader</span><span class="p">,</span> <span class="n">noise_levels</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">])</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="n">analyzer</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</code></pre></div>
<h3 id="regime-change-analyzer">Regime Change Analyzer</h3>
<p>Analyzes strategy performance across different market regimes (bull, bear, volatile, etc.). This analyzer helps identify how your strategy behaves in different market conditions and potential vulnerabilities.</p>
<p><strong>What it generates:</strong>
- Market regime identification and classification
- Performance metrics for each regime
- Regime transition analysis
- Strategy behavior across market conditions
- Comprehensive regime performance report</p>
<p><strong>Best for:</strong> Risk management, strategy optimization, and understanding market condition dependencies.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">portwine.analyzers</span><span class="w"> </span><span class="kn">import</span> <span class="n">RegimeChangeAnalyzer</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="c1"># Analyze regime performance</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="n">analyzer</span> <span class="o">=</span> <span class="n">RegimeChangeAnalyzer</span><span class="p">()</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="n">analyzer</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;combined&#39;</span><span class="p">)</span>
</code></pre></div>
<h2 id="writing-your-own-analyzers">Writing Your Own Analyzers</h2>
<p>You can also write your own analyzers by following the simple analyzer API. Here's a step-by-step example of creating a custom "Volatility Regime Analyzer" that identifies and analyzes performance in different volatility environments.</p>
<h3 id="step-1-import-required-libraries">Step 1: Import Required Libraries</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">portwine.analyzers.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">Analyzer</span>
</code></pre></div>
<p><strong>Explanation:</strong>
- <code>pandas</code> and <code>numpy</code> for data manipulation and calculations
- <code>matplotlib.pyplot</code> for creating visualizations
- <code>Analyzer</code> base class from portwine that all analyzers must inherit from</p>
<h3 id="step-2-define-your-analyzer-class">Step 2: Define Your Analyzer Class</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">VolatilityRegimeAnalyzer</span><span class="p">(</span><span class="n">Analyzer</span><span class="p">):</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="sd">    Custom analyzer that identifies different volatility regimes and analyzes</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="sd">    strategy performance in each regime.</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="sd">    This analyzer helps understand how your strategy performs in:</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="sd">    - Low volatility periods (calm markets)</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="sd">    - Medium volatility periods (normal markets) </span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="sd">    - High volatility periods (stressful markets)</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
<p><strong>Explanation:</strong>
- Inherit from the <code>Analyzer</code> base class
- Add a comprehensive docstring explaining what your analyzer does
- This makes your analyzer compatible with the portwine framework</p>
<h3 id="step-3-initialize-your-analyzer">Step 3: Initialize Your Analyzer</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">volatility_window</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">regime_thresholds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="sd">        Initialize the analyzer with customizable parameters.</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="sd">        Parameters</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="sd">        ----------</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="sd">        volatility_window : int, default 60</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="sd">            Rolling window for volatility calculation (in days)</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="sd">        regime_thresholds : dict, optional</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="sd">            Custom thresholds for regime classification</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">volatility_window</span> <span class="o">=</span> <span class="n">volatility_window</span>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>        <span class="c1"># Default thresholds (30th and 70th percentiles)</span>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">regime_thresholds</span> <span class="o">=</span> <span class="n">regime_thresholds</span> <span class="ow">or</span> <span class="p">{</span>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>            <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="mf">0.30</span><span class="p">,</span>    <span class="c1"># Below 30th percentile = low volatility</span>
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>            <span class="s1">&#39;high&#39;</span><span class="p">:</span> <span class="mf">0.70</span>    <span class="c1"># Above 70th percentile = high volatility</span>
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>        <span class="p">}</span>
</code></pre></div>
<p><strong>Explanation:</strong>
- <code>__init__</code> method sets up your analyzer with configurable parameters
- <code>volatility_window</code> determines how many days to use for rolling volatility
- <code>regime_thresholds</code> allows users to customize how regimes are defined
- Default thresholds use 30<sup>th</sup> and 70<sup>th</sup> percentiles for robust regime classification</p>
<h3 id="step-4-implement-the-analysis-logic">Step 4: Implement the Analysis Logic</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">identify_volatility_regimes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">returns</span><span class="p">):</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="sd">        Identify volatility regimes based on rolling volatility.</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="sd">        Parameters</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="sd">        ----------</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="sd">        returns : pd.Series</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="sd">            Daily returns series</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="sd">        Returns</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="sd">        -------</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="sd">        pd.Series</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="sd">            Regime labels for each date</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>        <span class="c1"># Calculate rolling volatility (annualized)</span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>        <span class="n">rolling_vol</span> <span class="o">=</span> <span class="n">returns</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">volatility_window</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">252</span><span class="p">)</span>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>        <span class="c1"># Calculate percentile thresholds</span>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>        <span class="n">low_threshold</span> <span class="o">=</span> <span class="n">rolling_vol</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regime_thresholds</span><span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">])</span>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>        <span class="n">high_threshold</span> <span class="o">=</span> <span class="n">rolling_vol</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regime_thresholds</span><span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">])</span>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>        <span class="c1"># Classify regimes</span>
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>        <span class="n">regimes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">returns</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span>
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>        <span class="n">regimes</span><span class="p">[</span><span class="n">rolling_vol</span> <span class="o">&lt;=</span> <span class="n">low_threshold</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;low_vol&#39;</span>
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>        <span class="n">regimes</span><span class="p">[</span><span class="n">rolling_vol</span> <span class="o">&gt;=</span> <span class="n">high_threshold</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;high_vol&#39;</span>
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>        <span class="n">regimes</span><span class="p">[(</span><span class="n">rolling_vol</span> <span class="o">&gt;</span> <span class="n">low_threshold</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">rolling_vol</span> <span class="o">&lt;</span> <span class="n">high_threshold</span><span class="p">)]</span> <span class="o">=</span> <span class="s1">&#39;medium_vol&#39;</span>
<a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a>
<a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a>        <span class="k">return</span> <span class="n">regimes</span><span class="p">,</span> <span class="n">rolling_vol</span>
</code></pre></div>
<p><strong>Explanation:</strong>
- <code>identify_volatility_regimes</code> is a helper method that does the core analysis
- Calculates rolling volatility using the specified window
- Annualizes volatility by multiplying by âˆš252 (trading days)
- Uses quantiles to determine regime thresholds dynamically
- Returns both regime labels and the volatility series for plotting</p>
<h3 id="step-5-calculate-performance-metrics">Step 5: Calculate Performance Metrics</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_regime_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">returns</span><span class="p">,</span> <span class="n">regimes</span><span class="p">,</span> <span class="n">ann_factor</span><span class="o">=</span><span class="mi">252</span><span class="p">):</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="sd">        Calculate performance metrics for each volatility regime.</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="sd">        Parameters</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="sd">        ----------</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="sd">        returns : pd.Series</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="sd">            Strategy returns</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="sd">        regimes : pd.Series</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="sd">            Regime labels for each date</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="sd">        ann_factor : int, default 252</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="sd">            Annualization factor</span>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="sd">        Returns</span>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="sd">        -------</span>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="sd">        dict</span>
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="sd">            Performance metrics for each regime</span>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>        <span class="n">metrics</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>        <span class="k">for</span> <span class="n">regime</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;low_vol&#39;</span><span class="p">,</span> <span class="s1">&#39;medium_vol&#39;</span><span class="p">,</span> <span class="s1">&#39;high_vol&#39;</span><span class="p">]:</span>
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a>            <span class="c1"># Filter returns for this regime</span>
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a>            <span class="n">regime_returns</span> <span class="o">=</span> <span class="n">returns</span><span class="p">[</span><span class="n">regimes</span> <span class="o">==</span> <span class="n">regime</span><span class="p">]</span>
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a>
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">regime_returns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a>                <span class="n">metrics</span><span class="p">[</span><span class="n">regime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a>                <span class="k">continue</span>
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a>
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a>            <span class="c1"># Calculate basic metrics</span>
<a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a>            <span class="n">total_return</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">regime_returns</span><span class="p">)</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a>            <span class="n">annual_return</span> <span class="o">=</span> <span class="n">regime_returns</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="n">ann_factor</span>
<a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a>            <span class="n">volatility</span> <span class="o">=</span> <span class="n">regime_returns</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ann_factor</span><span class="p">)</span>
<a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a>            <span class="n">sharpe_ratio</span> <span class="o">=</span> <span class="n">annual_return</span> <span class="o">/</span> <span class="n">volatility</span> <span class="k">if</span> <span class="n">volatility</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
<a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a>
<a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a>            <span class="c1"># Calculate maximum drawdown</span>
<a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a>            <span class="n">cumulative</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">regime_returns</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
<a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a>            <span class="n">running_max</span> <span class="o">=</span> <span class="n">cumulative</span><span class="o">.</span><span class="n">expanding</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<a id="__codelineno-15-38" name="__codelineno-15-38" href="#__codelineno-15-38"></a>            <span class="n">drawdown</span> <span class="o">=</span> <span class="p">(</span><span class="n">cumulative</span> <span class="o">-</span> <span class="n">running_max</span><span class="p">)</span> <span class="o">/</span> <span class="n">running_max</span>
<a id="__codelineno-15-39" name="__codelineno-15-39" href="#__codelineno-15-39"></a>            <span class="n">max_drawdown</span> <span class="o">=</span> <span class="n">drawdown</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<a id="__codelineno-15-40" name="__codelineno-15-40" href="#__codelineno-15-40"></a>
<a id="__codelineno-15-41" name="__codelineno-15-41" href="#__codelineno-15-41"></a>            <span class="c1"># Calculate win rate</span>
<a id="__codelineno-15-42" name="__codelineno-15-42" href="#__codelineno-15-42"></a>            <span class="n">win_rate</span> <span class="o">=</span> <span class="p">(</span><span class="n">regime_returns</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-15-43" name="__codelineno-15-43" href="#__codelineno-15-43"></a>
<a id="__codelineno-15-44" name="__codelineno-15-44" href="#__codelineno-15-44"></a>            <span class="n">metrics</span><span class="p">[</span><span class="n">regime</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-15-45" name="__codelineno-15-45" href="#__codelineno-15-45"></a>                <span class="s1">&#39;total_return&#39;</span><span class="p">:</span> <span class="n">total_return</span><span class="p">,</span>
<a id="__codelineno-15-46" name="__codelineno-15-46" href="#__codelineno-15-46"></a>                <span class="s1">&#39;annual_return&#39;</span><span class="p">:</span> <span class="n">annual_return</span><span class="p">,</span>
<a id="__codelineno-15-47" name="__codelineno-15-47" href="#__codelineno-15-47"></a>                <span class="s1">&#39;volatility&#39;</span><span class="p">:</span> <span class="n">volatility</span><span class="p">,</span>
<a id="__codelineno-15-48" name="__codelineno-15-48" href="#__codelineno-15-48"></a>                <span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">:</span> <span class="n">sharpe_ratio</span><span class="p">,</span>
<a id="__codelineno-15-49" name="__codelineno-15-49" href="#__codelineno-15-49"></a>                <span class="s1">&#39;max_drawdown&#39;</span><span class="p">:</span> <span class="n">max_drawdown</span><span class="p">,</span>
<a id="__codelineno-15-50" name="__codelineno-15-50" href="#__codelineno-15-50"></a>                <span class="s1">&#39;win_rate&#39;</span><span class="p">:</span> <span class="n">win_rate</span><span class="p">,</span>
<a id="__codelineno-15-51" name="__codelineno-15-51" href="#__codelineno-15-51"></a>                <span class="s1">&#39;days&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">regime_returns</span><span class="p">)</span>
<a id="__codelineno-15-52" name="__codelineno-15-52" href="#__codelineno-15-52"></a>            <span class="p">}</span>
<a id="__codelineno-15-53" name="__codelineno-15-53" href="#__codelineno-15-53"></a>
<a id="__codelineno-15-54" name="__codelineno-15-54" href="#__codelineno-15-54"></a>        <span class="k">return</span> <span class="n">metrics</span>
</code></pre></div>
<p><strong>Explanation:</strong>
- <code>calculate_regime_metrics</code> computes performance statistics for each regime
- Filters returns by regime and calculates comprehensive metrics
- Handles edge cases (empty regimes) gracefully
- Returns a structured dictionary with all metrics organized by regime</p>
<h3 id="step-6-implement-the-required-plot-method">Step 6: Implement the Required Plot Method</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">benchmark_label</span><span class="o">=</span><span class="s2">&quot;Benchmark&quot;</span><span class="p">):</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="sd">        Create comprehensive visualization of volatility regime analysis.</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="sd">        Parameters</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="sd">        ----------</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="sd">        results : dict</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="sd">            Results dictionary from backtester</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="sd">        figsize : tuple, default (15, 10)</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="sd">            Figure size (width, height)</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="sd">        benchmark_label : str, default &quot;Benchmark&quot;</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="sd">            Label for benchmark in plots</span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>        <span class="c1"># Extract data from results</span>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>        <span class="n">strategy_returns</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;strategy_returns&#39;</span><span class="p">]</span>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>        <span class="n">benchmark_returns</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;benchmark_returns&#39;</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a>        <span class="c1"># Identify regimes</span>
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a>        <span class="n">regimes</span><span class="p">,</span> <span class="n">rolling_vol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">identify_volatility_regimes</span><span class="p">(</span><span class="n">benchmark_returns</span><span class="p">)</span>
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a>
<a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a>        <span class="c1"># Calculate metrics</span>
<a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a>        <span class="n">strategy_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_regime_metrics</span><span class="p">(</span><span class="n">strategy_returns</span><span class="p">,</span> <span class="n">regimes</span><span class="p">)</span>
<a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a>        <span class="n">benchmark_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_regime_metrics</span><span class="p">(</span><span class="n">benchmark_returns</span><span class="p">,</span> <span class="n">regimes</span><span class="p">)</span>
<a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a>
<a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a>        <span class="c1"># Create the visualization</span>
<a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a>        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
<a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a>        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Volatility Regime Analysis&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a>
<a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a>        <span class="c1"># Plot 1: Rolling Volatility with Regime Overlay</span>
<a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a>        <span class="n">ax1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rolling_vol</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">rolling_vol</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Rolling Volatility&#39;</span><span class="p">)</span>
<a id="__codelineno-16-32" name="__codelineno-16-32" href="#__codelineno-16-32"></a>
<a id="__codelineno-16-33" name="__codelineno-16-33" href="#__codelineno-16-33"></a>        <span class="c1"># Color-code by regime</span>
<a id="__codelineno-16-34" name="__codelineno-16-34" href="#__codelineno-16-34"></a>        <span class="k">for</span> <span class="n">regime</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="p">[(</span><span class="s1">&#39;low_vol&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;medium_vol&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;high_vol&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">)]:</span>
<a id="__codelineno-16-35" name="__codelineno-16-35" href="#__codelineno-16-35"></a>            <span class="n">regime_mask</span> <span class="o">=</span> <span class="n">regimes</span> <span class="o">==</span> <span class="n">regime</span>
<a id="__codelineno-16-36" name="__codelineno-16-36" href="#__codelineno-16-36"></a>            <span class="k">if</span> <span class="n">regime_mask</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
<a id="__codelineno-16-37" name="__codelineno-16-37" href="#__codelineno-16-37"></a>                <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rolling_vol</span><span class="p">[</span><span class="n">regime_mask</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">rolling_vol</span><span class="p">[</span><span class="n">regime_mask</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
<a id="__codelineno-16-38" name="__codelineno-16-38" href="#__codelineno-16-38"></a>                           <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">regime</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-16-39" name="__codelineno-16-39" href="#__codelineno-16-39"></a>
<a id="__codelineno-16-40" name="__codelineno-16-40" href="#__codelineno-16-40"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Rolling Volatility with Regime Classification&#39;</span><span class="p">)</span>
<a id="__codelineno-16-41" name="__codelineno-16-41" href="#__codelineno-16-41"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Annualized Volatility&#39;</span><span class="p">)</span>
<a id="__codelineno-16-42" name="__codelineno-16-42" href="#__codelineno-16-42"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a id="__codelineno-16-43" name="__codelineno-16-43" href="#__codelineno-16-43"></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-16-44" name="__codelineno-16-44" href="#__codelineno-16-44"></a>
<a id="__codelineno-16-45" name="__codelineno-16-45" href="#__codelineno-16-45"></a>        <span class="c1"># Plot 2: Cumulative Returns by Regime</span>
<a id="__codelineno-16-46" name="__codelineno-16-46" href="#__codelineno-16-46"></a>        <span class="n">ax2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-16-47" name="__codelineno-16-47" href="#__codelineno-16-47"></a>        <span class="n">cumulative_strategy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">strategy_returns</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
<a id="__codelineno-16-48" name="__codelineno-16-48" href="#__codelineno-16-48"></a>
<a id="__codelineno-16-49" name="__codelineno-16-49" href="#__codelineno-16-49"></a>        <span class="k">for</span> <span class="n">regime</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="p">[(</span><span class="s1">&#39;low_vol&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;medium_vol&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;high_vol&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">)]:</span>
<a id="__codelineno-16-50" name="__codelineno-16-50" href="#__codelineno-16-50"></a>            <span class="n">regime_mask</span> <span class="o">=</span> <span class="n">regimes</span> <span class="o">==</span> <span class="n">regime</span>
<a id="__codelineno-16-51" name="__codelineno-16-51" href="#__codelineno-16-51"></a>            <span class="k">if</span> <span class="n">regime_mask</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
<a id="__codelineno-16-52" name="__codelineno-16-52" href="#__codelineno-16-52"></a>                <span class="n">regime_returns</span> <span class="o">=</span> <span class="n">strategy_returns</span><span class="p">[</span><span class="n">regime_mask</span><span class="p">]</span>
<a id="__codelineno-16-53" name="__codelineno-16-53" href="#__codelineno-16-53"></a>                <span class="n">regime_cumulative</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">regime_returns</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
<a id="__codelineno-16-54" name="__codelineno-16-54" href="#__codelineno-16-54"></a>                <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">regime_cumulative</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">regime_cumulative</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
<a id="__codelineno-16-55" name="__codelineno-16-55" href="#__codelineno-16-55"></a>                        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">regime</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-16-56" name="__codelineno-16-56" href="#__codelineno-16-56"></a>
<a id="__codelineno-16-57" name="__codelineno-16-57" href="#__codelineno-16-57"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Strategy Performance by Volatility Regime&#39;</span><span class="p">)</span>
<a id="__codelineno-16-58" name="__codelineno-16-58" href="#__codelineno-16-58"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Cumulative Return&#39;</span><span class="p">)</span>
<a id="__codelineno-16-59" name="__codelineno-16-59" href="#__codelineno-16-59"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a id="__codelineno-16-60" name="__codelineno-16-60" href="#__codelineno-16-60"></a>        <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-16-61" name="__codelineno-16-61" href="#__codelineno-16-61"></a>
<a id="__codelineno-16-62" name="__codelineno-16-62" href="#__codelineno-16-62"></a>        <span class="c1"># Plot 3: Performance Metrics Comparison</span>
<a id="__codelineno-16-63" name="__codelineno-16-63" href="#__codelineno-16-63"></a>        <span class="n">ax3</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-16-64" name="__codelineno-16-64" href="#__codelineno-16-64"></a>        <span class="n">ax3</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<a id="__codelineno-16-65" name="__codelineno-16-65" href="#__codelineno-16-65"></a>
<a id="__codelineno-16-66" name="__codelineno-16-66" href="#__codelineno-16-66"></a>        <span class="c1"># Create metrics table</span>
<a id="__codelineno-16-67" name="__codelineno-16-67" href="#__codelineno-16-67"></a>        <span class="n">metrics_data</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-16-68" name="__codelineno-16-68" href="#__codelineno-16-68"></a>        <span class="k">for</span> <span class="n">regime</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;low_vol&#39;</span><span class="p">,</span> <span class="s1">&#39;medium_vol&#39;</span><span class="p">,</span> <span class="s1">&#39;high_vol&#39;</span><span class="p">]:</span>
<a id="__codelineno-16-69" name="__codelineno-16-69" href="#__codelineno-16-69"></a>            <span class="k">if</span> <span class="n">strategy_metrics</span><span class="p">[</span><span class="n">regime</span><span class="p">]:</span>
<a id="__codelineno-16-70" name="__codelineno-16-70" href="#__codelineno-16-70"></a>                <span class="n">metrics_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
<a id="__codelineno-16-71" name="__codelineno-16-71" href="#__codelineno-16-71"></a>                    <span class="n">regime</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span>
<a id="__codelineno-16-72" name="__codelineno-16-72" href="#__codelineno-16-72"></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">strategy_metrics</span><span class="p">[</span><span class="n">regime</span><span class="p">][</span><span class="s1">&#39;annual_return&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-16-73" name="__codelineno-16-73" href="#__codelineno-16-73"></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">strategy_metrics</span><span class="p">[</span><span class="n">regime</span><span class="p">][</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-16-74" name="__codelineno-16-74" href="#__codelineno-16-74"></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">strategy_metrics</span><span class="p">[</span><span class="n">regime</span><span class="p">][</span><span class="s1">&#39;max_drawdown&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-16-75" name="__codelineno-16-75" href="#__codelineno-16-75"></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">strategy_metrics</span><span class="p">[</span><span class="n">regime</span><span class="p">][</span><span class="s1">&#39;days&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-16-76" name="__codelineno-16-76" href="#__codelineno-16-76"></a>                <span class="p">])</span>
<a id="__codelineno-16-77" name="__codelineno-16-77" href="#__codelineno-16-77"></a>
<a id="__codelineno-16-78" name="__codelineno-16-78" href="#__codelineno-16-78"></a>        <span class="n">table</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="n">cellText</span><span class="o">=</span><span class="n">metrics_data</span><span class="p">,</span>
<a id="__codelineno-16-79" name="__codelineno-16-79" href="#__codelineno-16-79"></a>                         <span class="n">colLabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Regime&#39;</span><span class="p">,</span> <span class="s1">&#39;Ann. Return&#39;</span><span class="p">,</span> <span class="s1">&#39;Sharpe&#39;</span><span class="p">,</span> <span class="s1">&#39;Max DD&#39;</span><span class="p">,</span> <span class="s1">&#39;Days&#39;</span><span class="p">],</span>
<a id="__codelineno-16-80" name="__codelineno-16-80" href="#__codelineno-16-80"></a>                         <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
<a id="__codelineno-16-81" name="__codelineno-16-81" href="#__codelineno-16-81"></a>                         <span class="n">cellLoc</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<a id="__codelineno-16-82" name="__codelineno-16-82" href="#__codelineno-16-82"></a>        <span class="n">table</span><span class="o">.</span><span class="n">auto_set_font_size</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-16-83" name="__codelineno-16-83" href="#__codelineno-16-83"></a>        <span class="n">table</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-16-84" name="__codelineno-16-84" href="#__codelineno-16-84"></a>        <span class="n">table</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
<a id="__codelineno-16-85" name="__codelineno-16-85" href="#__codelineno-16-85"></a>        <span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Strategy Performance by Regime&#39;</span><span class="p">)</span>
<a id="__codelineno-16-86" name="__codelineno-16-86" href="#__codelineno-16-86"></a>
<a id="__codelineno-16-87" name="__codelineno-16-87" href="#__codelineno-16-87"></a>        <span class="c1"># Plot 4: Regime Distribution</span>
<a id="__codelineno-16-88" name="__codelineno-16-88" href="#__codelineno-16-88"></a>        <span class="n">ax4</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-16-89" name="__codelineno-16-89" href="#__codelineno-16-89"></a>        <span class="n">regime_counts</span> <span class="o">=</span> <span class="n">regimes</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<a id="__codelineno-16-90" name="__codelineno-16-90" href="#__codelineno-16-90"></a>        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">]</span>
<a id="__codelineno-16-91" name="__codelineno-16-91" href="#__codelineno-16-91"></a>        <span class="n">ax4</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">regime_counts</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">regime_counts</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.1f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
<a id="__codelineno-16-92" name="__codelineno-16-92" href="#__codelineno-16-92"></a>        <span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Distribution of Volatility Regimes&#39;</span><span class="p">)</span>
<a id="__codelineno-16-93" name="__codelineno-16-93" href="#__codelineno-16-93"></a>
<a id="__codelineno-16-94" name="__codelineno-16-94" href="#__codelineno-16-94"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a id="__codelineno-16-95" name="__codelineno-16-95" href="#__codelineno-16-95"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-16-96" name="__codelineno-16-96" href="#__codelineno-16-96"></a>
<a id="__codelineno-16-97" name="__codelineno-16-97" href="#__codelineno-16-97"></a>        <span class="c1"># Print summary statistics</span>
<a id="__codelineno-16-98" name="__codelineno-16-98" href="#__codelineno-16-98"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_print_summary</span><span class="p">(</span><span class="n">strategy_metrics</span><span class="p">,</span> <span class="n">benchmark_metrics</span><span class="p">)</span>
</code></pre></div>
<p><strong>Explanation:</strong>
- The <code>plot</code> method is the main interface that users will call
- Extracts data from the results dictionary
- Calls helper methods to perform analysis
- Creates a comprehensive 2x2 subplot layout
- Each subplot shows different aspects of the analysis
- Includes proper labeling, legends, and formatting
- Calls a helper method to print summary statistics</p>
<h3 id="step-7-add-helper-methods">Step 7: Add Helper Methods</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_print_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strategy_metrics</span><span class="p">,</span> <span class="n">benchmark_metrics</span><span class="p">):</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="sd">        Print a summary of the analysis results.</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="sd">        Parameters</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="sd">        ----------</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="sd">        strategy_metrics : dict</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="sd">            Strategy performance metrics by regime</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="sd">        benchmark_metrics : dict</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="sd">            Benchmark performance metrics by regime</span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VOLATILITY REGIME ANALYSIS SUMMARY&quot;</span><span class="p">)</span>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>        <span class="k">for</span> <span class="n">regime</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;low_vol&#39;</span><span class="p">,</span> <span class="s1">&#39;medium_vol&#39;</span><span class="p">,</span> <span class="s1">&#39;high_vol&#39;</span><span class="p">]:</span>
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a>            <span class="k">if</span> <span class="n">strategy_metrics</span><span class="p">[</span><span class="n">regime</span><span class="p">]:</span>
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">regime</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2"> Regime:&quot;</span><span class="p">)</span>
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Days: </span><span class="si">{</span><span class="n">strategy_metrics</span><span class="p">[</span><span class="n">regime</span><span class="p">][</span><span class="s1">&#39;days&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Annual Return: </span><span class="si">{</span><span class="n">strategy_metrics</span><span class="p">[</span><span class="n">regime</span><span class="p">][</span><span class="s1">&#39;annual_return&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Sharpe Ratio: </span><span class="si">{</span><span class="n">strategy_metrics</span><span class="p">[</span><span class="n">regime</span><span class="p">][</span><span class="s1">&#39;sharpe_ratio&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Max Drawdown: </span><span class="si">{</span><span class="n">strategy_metrics</span><span class="p">[</span><span class="n">regime</span><span class="p">][</span><span class="s1">&#39;max_drawdown&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Win Rate: </span><span class="si">{</span><span class="n">strategy_metrics</span><span class="p">[</span><span class="n">regime</span><span class="p">][</span><span class="s1">&#39;win_rate&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a>
<a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
</code></pre></div>
<p><strong>Explanation:</strong>
- Helper method to print formatted summary statistics
- Provides clear, readable output of key findings
- Uses consistent formatting for professional presentation</p>
<h3 id="step-8-usage-example">Step 8: Usage Example</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># Create and use your custom analyzer</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">portwine.analyzers</span><span class="w"> </span><span class="kn">import</span> <span class="n">VolatilityRegimeAnalyzer</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="c1"># Initialize with custom parameters</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="n">analyzer</span> <span class="o">=</span> <span class="n">VolatilityRegimeAnalyzer</span><span class="p">(</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>    <span class="n">volatility_window</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>  <span class="c1"># 90-day rolling window</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>    <span class="n">regime_thresholds</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>        <span class="s1">&#39;low&#39;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>    <span class="c1"># Bottom 25% = low volatility</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>        <span class="s1">&#39;high&#39;</span><span class="p">:</span> <span class="mf">0.75</span>    <span class="c1"># Top 25% = high volatility</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>    <span class="p">}</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="p">)</span>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="c1"># Run the analysis</span>
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="n">analyzer</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
</code></pre></div>
<p><strong>Explanation:</strong>
- Shows how to instantiate your custom analyzer
- Demonstrates parameter customization
- Shows the simple interface for running the analysis</p>
<h3 id="key-design-principles">Key Design Principles</h3>
<ol>
<li><strong>Inherit from Analyzer</strong>: Always inherit from the base <code>Analyzer</code> class</li>
<li><strong>Clear Documentation</strong>: Provide comprehensive docstrings for all methods</li>
<li><strong>Flexible Parameters</strong>: Allow users to customize key parameters</li>
<li><strong>Error Handling</strong>: Handle edge cases gracefully (empty data, missing regimes)</li>
<li><strong>Professional Visualization</strong>: Create clear, informative plots with proper formatting</li>
<li><strong>Modular Design</strong>: Break complex logic into smaller, focused methods</li>
<li><strong>Consistent Interface</strong>: Follow the same pattern as built-in analyzers</li>
</ol>
<p>This example demonstrates how to create a sophisticated custom analyzer that provides valuable insights while maintaining the same professional interface as the built-in analyzers.</p>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li>Learn about <a href="../strategies/">building strategies</a></li>
<li>Explore <a href="../backtesting/">backtesting</a></li>
<li>Check out <a href="../data-management/">data management</a> </li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../data-management/" class="btn btn-neutral float-left" title="Data Management"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../contributing/" class="btn btn-neutral float-right" title="Contributing">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/StuartFarmer/portwine" class="fa fa-code-fork" style="color: #fcfcfc"> portwine</a>
        </span>
    
    
      <span><a href="../data-management/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../contributing/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
